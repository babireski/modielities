\newcommand\turnstile[3][2]
{%
  \mathrel{\calcturnstile{#1}%
  \setbox0=\hbox{$\tsvstyle\vdash$}%
  \setbox2=\hbox{$\vcenter{\copy0}$}%
  \hbox
  {
    \vrule\vphantom{$\tsvstyle\vdash$}}%
    \raise\dimexpr\ht0-\ht2\relax\hbox{$\vcenter{\offinterlineskip
    \ialign
    {
      \hfil\kern1pt$\tsstyle##\vphantom{by}$\kern1pt\hfil\cr
      \relax\if\relax\detokenize{#2}\relax\hphantom{\vdash}\kern-2pt\else#2\fi\cr
      \noalign{\kern1pt\hrule\kern1pt}%
      \relax\if\relax\detokenize{#2}\relax\hphantom{\vdash}\kern-2pt\else#3\fi\cr}}$
    }%
  }
}

\newcommand\Turnstile[3][2]{%
  \mathrel{\calcturnstile{#1}%
  \vcenter{\hbox{\vrule\vphantom{$\tsvstyle\models$}}}%
  \vcenter{\offinterlineskip
   \ialign{\hfil\kern1pt$\tsstyle##\vphantom{by}$\hfil\cr
           \relax\if\relax\detokenize{#2}\relax\hphantom{=}\kern-2pt\else#2\fi\cr
           \noalign{\kern1pt\hrule\kern\fontdimen22\tsfont2\hrule\kern1pt}%
           \relax\if\relax\detokenize{#2}\relax\hphantom{-}\kern-2pt\else#3\fi\cr}}
}}
\newcommand\calcturnstile[1]{%
  \ifcase#1\let\tsstyle\textstyle\let\tsvstyle\textstyle\let\tsfont\textfont\or
    \let\tsstyle\textstyle\let\tsvstyle\textstyle\let\tsfont\textfont\or
    \let\tsstyle\scriptstyle\let\tsvstyle\textstyle\let\tsfont\scriptfont\or
    \let\tsstyle\scriptscriptstyle\let\tsvstyle\scriptstyle\let\tsfont\scriptscriptfont\fi}
